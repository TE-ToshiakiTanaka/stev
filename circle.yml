checkout:
  post:
    - chmod +x ./test/data/bin/chrome/Linux/x86/chromedriver
    - chmod +x ./test/data/bin/chrome/Linux/x86/chromedriver
    - ls -la ./test/data/bin/*

machine:
    java:
        version: openjdk7
    python:
        version: '2.7.10'
    timezone: Asia/Tokyo
    environment:
        # ANDROID_HOME: /usr/local/android-sdk-linux
        TOX_PY27: '2.7.10'

dependencies:
    pre:
        - /bin/bash opencv_install.sh
        - pip -V
        - pip install -U ipdb
        - pip install -U -r requirements.txt
        - pyenv local $TOX_PY27
        # - echo y | android update sdk --no-ui --all --filter "tool"
        # - echo y | android update sdk --no-ui --all --filter "extra-android-m2repository"
        # - echo y | android update sdk --no-ui --all --filter "extra-android-support"
        # - echo y | android update sdk --no-ui --all --filter "extra-google-google_play_services"
        # - echo y | android update sdk --no-ui --all --filter "extra-google-m2repository"
        # - echo y | android update sdk --no-ui --all --filter "android-23"
        # - echo y | android update sdk --no-ui --all --filter "build-tools-23.0.2"
        # - echo n | android create avd --force --name emulator-android-23 --target android-23 -c 50M

test:
    override:
        #- emulator -avd emulator-android-23 -no-audio -no-window:
        #     background: true
        #     parallel: true
        # - circle-android wait-for-boot
        # - adb devices
        # - tox -v
        - chmod +x test/data/bin/*
        - nosetests --verbose --nocapture --logging-level=DEBUG --with-xunit --with-coverage --cover-branches --cover-package=stve --cover-html
        - python setup.py bdist_wheel

    post:
        - mkdir -p $CIRCLE_TEST_REPORTS/nose/
        - mv nosetests.xml $CIRCLE_TEST_REPORTS/nose/
        - mv dist $CIRCLE_ARTIFACTS
        - mv cover $CIRCLE_ARTIFACTS
